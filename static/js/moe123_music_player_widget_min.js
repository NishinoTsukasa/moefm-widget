/* Moefm-widget v0.1 aka-rin.com | aka-rin.com/license */
var Player={data:[],api_host:"",api_random_list:"",api_music_list:"",init_player:function(e,t,n){Player.api_host=e;Player.api_random_list=t;Player.api_music_list=n;$("#moe123_music_player").jPlayer({ready:Player.on_player_ready,ended:Player.on_play_ended,loadstart:function(e){Player.set_msg("开始链接音乐...")},loadeddata:function(e){Player.set_msg("音乐链接完成~")},volume:.6,timeupdate:Player.on_player_timeupdate,swfPath:"static/js/jplayer/",supplied:"mp3",wmode:"window",smoothPlayBar:true,keyEnabled:true,cssSelectorAncestor:"",cssSelector:{play:"#moe123_music_player_play",pause:"#moe123_music_player_pause",mute:"#moe123_music_player_mute",unmute:"#moe123_music_player_unmute",currentTime:"#moe123_music_player_current_time",duration:"#moe123_music_player_duration"}})},get_random_int:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},progressbar:function(e,t){var n=e*t.width()/100;t.find("div").css({width:n+"px"},500).html(e+"% ")},play:function(e){if(Player.data.length<1)return;if(typeof e=="number"){$("#moe123_music_player_back img").stop(true,true).fadeOut(function(){$("#moe123_music_player_back img").attr("src",Player.data[e].cover.square);if(!$("#moe123_music_player_back img").complete)$("#moe123_music_player_back img").load(function(){if($("#moe123_music_player_widget").css("height")=="70px")$("#moe123_music_player_back img").css("margin-top",-(($("#moe123_music_player_back img").height()-70)/3)+"px");$("#moe123_music_player_back img").fadeIn()});else $("#moe123_music_player_back img").fadeIn()});$("#moe123_music_player_title").html(Player.data[e].title);$("#moe123_music_player_title").attr("href",Player.data[e].wiki_url);$("#moe123_music_player").jPlayer("setMedia",Player.parse_media(e));$("#moe123_music_player").jPlayer("play",0);$("#moe123_music_player_back").css("height",$("#moe123_music_player_wrapper").height()+10+"px")}},play_prev:function(){if($("#moe123_music_player_list a").length==0)return;Player.clean();if($("#moe123_music_player_list_repeat").is(":visible")){$("#moe123_music_player").jPlayer("stop",0);var e=$("#moe123_music_player_list .on").prev(),t;if(e.length==0){t=parseInt($("#moe123_music_player_list a").last().attr("data-music-id"));$("#moe123_music_player_list a").removeClass("on");$("#moe123_music_player_list a").last().addClass("on")}else{t=parseInt(e.attr("data-music-id"));$("#moe123_music_player_list a").removeClass("on");e.addClass("on")}Player.play(t)}else{Player.play(parseInt($("#moe123_music_player_list .on").attr("data-music-id")))}},play_next:function(){if($("#moe123_music_player_list a").length==0)return;var e;Player.clean();if($("#moe123_music_player_list_random").is(":visible")){var t=Player.get_random_int(0,$("#moe123_music_player_list a").length-1);e=parseInt($("#moe123_music_player_list a:eq("+t+")").attr("data-music-id"));$("#moe123_music_player_list a").removeClass("on");$("#moe123_music_player_list a:eq("+t+")").addClass("on")}else if($("#moe123_music_player_repeat").is(":visible")){if($("#moe123_music_player_list .on").length==0){e=parseInt($("#moe123_music_player_list a").first().attr("data-music-id"))}else{e=parseInt($("#moe123_music_player_list .on").attr("data-music-id"))}}else $("#moe123_music_player_list_repeat").is(":visible");{var n=$("#moe123_music_player_list .on").next();if(n.length==0){e=parseInt($("#moe123_music_player_list a").first().attr("data-music-id"));$("#moe123_music_player_list a").removeClass("on");$("#moe123_music_player_list a").first().addClass("on")}else{e=parseInt(n.attr("data-music-id"));$("#moe123_music_player_list a").removeClass("on");n.addClass("on")}}Player.play(e)},single_repeat:function(){$("#moe123_music_player_seq_group a").hide();$("#moe123_music_player_repeat").show()},list_repeat:function(){$("#moe123_music_player_seq_group a").hide();$("#moe123_music_player_list_repeat").show()},list_random:function(){$("#moe123_music_player_seq_group a").hide();$("#moe123_music_player_list_random").show()},set_msg:function(e){$("#moe123_music_player_message").html(e)},parse_media:function(e){return{mp3:Player.data[e].url}},clean:function(){Player.progressbar(0,$("#moe123_music_player_progress"));$("#moe123_music_player_back img").attr("src","http://static.moe123.com/static/img/spaceball.gif");$("#moe123_music_player_title").html("萌否电台");$("#moe123_music_player_title").attr("href","http://moe.fm/");$("#moe123_music_player").jPlayer("stop",0);$("#moe123_music_player").jPlayer("setMedia",{})},force_update:function(){Player.clean();$("#moe123_music_player_list").empty();Player.set_msg("正在刷新...");$.getJSON(Player.api_host+Player.api_random_list,Player.on_data_ready)},on_play_ended:function(e){Player.play_next()},on_data_ready:function(e){var t=e.playlist,n=0,r=0;for(n in t){r=Player.data.push(t[n]);$("#moe123_music_player_list").append("<a title='"+t[n].title+"' data-music-id='"+ --r+"' href='javascript:void(0)'>"+t[n].title+"</a>")}$("#moe123_music_player_list a").click(function(){Player.clean();Player.play(parseInt($(this).attr("data-music-id")));$("#moe123_music_player_list a").removeClass("on");$(this).addClass("on")});Player.set_msg("初始化完成")},on_player_ready:function(e){Player.progressbar(0,$("#moe123_music_player_progress"));$("#moe123_music_player_wrapper").fadeIn();$("#moe123_music_player_back").css("filter","alpha(opacity=25)");$("#moe123_music_player_back img").css("filter","alpha(opacity=25)");$("#moe123_music_player_progress").css("filter","alpha(opacity=60)");$("#moe123_music_player_widget").hover(function(e){$("#mail-login-form").hide();$("#moe123_left_widgets").css("height","600px");$("#moe123_music_player_back img").css("margin-top","0px");$(this).css("height","auto")},function(e){$("#mail-login-form").show();$("#moe123_left_widgets").css("height","680px");$("#moe123_music_player_back img").hide();$("#moe123_music_player_back img").css("margin-top",-(($("#moe123_music_player_back img").height()-70)/3)+"px");$("#moe123_music_player_back img").stop(true,true).fadeIn();$(this).css("height","70px")});$("#moe123_music_player_prev").click(function(e){Player.play_prev()});$("#moe123_music_player_next").click(function(e){Player.play_next()});$("#moe123_music_player_repeat").click(function(e){Player.list_repeat()});$("#moe123_music_player_list_repeat").click(function(e){Player.list_random()});$("#moe123_music_player_list_random").click(function(e){Player.single_repeat()});Player.list_repeat();$.getJSON(Player.api_host+Player.api_music_list,Player.on_data_ready)},on_player_timeupdate:function(e){Player.progressbar(e.jPlayer.status.currentTime/e.jPlayer.status.duration*100,$("#moe123_music_player_progress"))}}